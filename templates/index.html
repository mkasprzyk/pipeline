<html>
<head>
<link rel="stylesheet" type="text/css" href="static/css/style.css">
</head>

<body>
<div id="pipeline"></div>

<script type="text/javascript" src="static/js/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="static/js/d3.min.js"></script>
<script type="text/javascript" src="static/js/d3.layout.min.js"></script>
<script type="text/javascript" src="static/js/pipeline.js"></script>

<script>
    $(function () {
        var eventContainer = document.getElementById("event");
        var eventSource = new EventSource("/events");

        var dispatchEvent = function(event_data) {
         $.each(event_data, function(job, status) {
                console.log(status);
                handler = d3.select('#'+job.toLowerCase()+'-circle');
                if (status.is_running) {
                    handler.style('animation', 'blinker 2s linear infinite');
                } else {
                    handler.style('animation', 'false');
                }
                if (status.is_good) {
                    handler.style('fill', 'blue')
                } else {
                    handler.style('fill', 'red')
                }
            })
         }

         eventSource.onopen = function(e) {
            console.log('Connection opened, getting results from cache');
         };

         eventSource.onmessage = function(e) {
            event_data = JSON.parse(e.data);
            dispatchEvent(event_data);
         };

        $.getJSON('/pipeline', function(data) {
            buildPipeline("#pipeline", data);
        })
        .fail(function() {
            console.log("Corrupted pipeline JSON file");
        })

    });
</script>

</body>
</html>
